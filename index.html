<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="nl" lang="nl">
<head>
  <title>OMG editor</title>
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
  <meta http-equiv="Content-Language" content="nl" />
  <meta name="MSSmartTagsPreventParsing" content="true" />

  <meta name="publisher" content="Your title" />
  <meta name="copyright" content="Copyright &#169; Your title.org &amp; Mannetje Development 2010" />
  <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <style style="text/css">
    body { 
      font-family: "Open Sans", Arial; 
      font-size:16px; 
      font-color: #555;
      background: url('editor.back.jpg');
      padding:2.0em;
    }
    textarea {
      background-color:#555;
      color:#EEE;
      padding:1.0em;
      box-sizing: border-box;
    }
    div.left,
    div.right{
      width:48%;
      float:left;
    }
    div.right textarea {
      height:48vh; 
      width:48vw;
      margin-bottom:2.0em;
    }
    div.left textarea{
      width:42vw; 
      height:100vh;
    }
    .clear { clear:both; }
    div#adapter { width:300px; float:left }
    img#logo { float:left; width:44%; }
    button,select { font-size:17px; }
    .description{ text-align:justify; color:#FFF; font-size:14px; }
    a:visited { font-weight:bold; color:#FFF }
    #advanced input { width:50px }
    fieldset#advanced { background-color:#999; margin-top:1.0em; }
  </style>
  <script>

    templates = [];
    templates["none"] = {
      "json": '{\n\n}',
      "adapter":"none",
      "extra": ""
    }
    templates["github"] = {
      "json": '{\n  "repositories": {\n    "output": [\n      {\n        "$ref": "#ui.console"\n      }\n    ],\n    "type": "array",\n    "items": [\n      {\n        "$ref": "#repository"\n      }\n    ],\n    "input": {\n      "order": {\n        "type": "string",\n        "enum": [\n          "asc",\n          "desc"\n        ],\n        "value": "asc"\n      },\n      "sort": {\n        "type": "string",\n        "enum": [\n          "created",\n          "stars",\n          "updated",\n          "pushed"\n        ],\n        "value": "stars"\n      },\n      "q": {\n        "type": "string",\n        "value": "ohmygod"\n      }\n    },\n    "request": {\n      "get": {\n        "config": {\n          "method": "get",\n          "url": "https://api.github.com/search/repositories",\n          "payload": {\n            "q": "{repositories.input.q.value}",\n            "sort": "{repositories.input.sort.value}",\n            "order": "{repositories.input.order.value}"\n          }\n        },\n        "data": "{response.items}"\n      }\n    }\n  },\n  "repository": {\n    "type": "object",\n    "data": {},\n    "properties": {\n      "html_url": {\n        "type": "string"\n      },\n      "stargazers_count": {\n        "type": "number"\n      },\n      "owner": {\n        "type": "object",\n        "properties": {\n          "login": {\n            "type": "string"\n          }\n        }\n      }\n    },\n    "request": {\n      "get": {\n        "config": {\n          "method": "get",\n          "url": "https://api.github.com/repos/{repository.data.full_name}",\n          "payload": {}\n        },\n        "data": "{response}"\n      },\n      "post": {\n        "type": "request",\n        "config": {\n          "method": "post",\n          "url": "/repos/{repository.data.full_name}",\n          "payload": {\n            "full_name": "{repository.data.full_name}"\n          }\n        }\n      }\n    }\n  }\n}',
      "adapter": "none",
      "extra": "//\n// just try the above calls in your browser console, like:\n//\n//   repositories = omg.graph.repositories;\n//   repositories.get() // <- returns array of 'repository' objects..sweet!\n//\n// also you can pass payloads like this:\n//\n//    repositories.get({sort:'asc'})\n// or using variable binding like this:\n//\n//    &lt;form onsubmit=\"repositories.get()\"&gt;\n//      &lt;input onchange=\"repositories.data.q = this.value\"/&gt;\n//    &lt;/form&gt;\n\n"
    }
    templates["githubextend"] = {
      "json": '{\n  "$extend":{\n    "$ref":"#/repository/request",\n    "update": {\n      "config": {\n        "method": "put",\n        "url": "https://api.github.com/search/repositories",\n        "payload": {\n          "foo": "{repositories.input.q.value}"\n        }\n      },\n      "data": "{response.items}"\n    }\n  },\n  "repositories": {\n    "output": [\n      {\n        "$ref": "#ui.console"\n      }\n    ],\n    "type": "array",\n    "items": [\n      {\n        "$ref": "#repository"\n      }\n    ],\n    "input": {\n      "order": {\n        "type": "string",\n        "enum": [\n          "asc",\n          "desc"\n        ],\n        "value": "asc"\n      },\n      "sort": {\n        "type": "string",\n        "enum": [\n          "created",\n          "stars",\n          "updated",\n          "pushed"\n        ],\n        "value": "stars"\n      },\n      "q": {\n        "type": "string",\n        "value": "ohmygod"\n      }\n    },\n    "request": {\n      "get": {\n        "config": {\n          "method": "get",\n          "url": "https://api.github.com/search/repositories",\n          "payload": {\n            "q": "{repositories.input.q.value}",\n            "sort": "{repositories.input.sort.value}",\n            "order": "{repositories.input.order.value}"\n          }\n        },\n        "data": "{response.items}"\n      }\n    }\n  },\n  "repository": {\n    "type": "object",\n    "data": {},\n    "properties": {\n      "html_url": {\n        "type": "string"\n      },\n      "stargazers_count": {\n        "type": "number"\n      },\n      "owner": {\n        "type": "object",\n        "properties": {\n          "login": {\n            "type": "string"\n          }\n        }\n      }\n    },\n    "request": {\n      "get": {\n        "config": {\n          "method": "get",\n          "url": "https://api.github.com/repos/{repository.data.full_name}",\n          "payload": {}\n        },\n        "data": "{response}"\n      },\n      "post": {\n        "type": "request",\n        "config": {\n          "method": "post",\n          "url": "/repos/{repository.data.full_name}",\n          "payload": {\n            "full_name": "{repository.data.full_name}"\n          }\n        }\n      }\n    }\n  }\n}\n',
      "adapter": "none",
      "extra": "// do you see that the 'foo'-key was moved downwards?"
    }
    templates["madeapi"] = {
      "json": '{\n  "kind": "structure",\n  "structure": {\n    "user": {\n      "table": "user",\n      "access": [\n        "read",\n        "update"\n      ],\n      "custom": {\n        "current": {\n          "read": {\n            "description": "Get current session user",\n            "method": "\\\\Foo\\\\Some\\\\Method\\\\current"\n          }\n        }\n      },\n      "required": [\n        "username"\n      ],\n      "payload": {\n        "id": {\n          "type": "integer",\n          "minimum": 1\n        },\n        "username": {\n          "type": "string",\n          "access": [\n            "create",\n            "read"\n          ]\n        }\n      },\n      "relations": {\n        "access": {\n          "resource": "access",\n          "local": "id",\n          "foreign": "user_id"\n        }\n      }\n    },\n    "access": {\n      "table": "user_access",\n      "access": [\n        "read"\n      ],\n      "required": [\n        "user",\n        "resource",\n        "foreign_id"\n      ],\n      "payload": {\n        "id": {\n          "title": {\n            "en": "id",\n            "nl": "id"\n          },\n          "description": "Identificatie nummer",\n          "function": "key",\n          "type": "integer",\n          "minimum": 1\n        },\n        "user": {\n          "description": "Gebruiker",\n          "type": "object",\n          "function": "relation",\n          "resource": "user"\n        },\n        "resource": {\n          "type": "string"\n        }\n      },\n      "relations": {\n        "user": {\n          "resource": "user",\n          "local": "user_id",\n          "foreign": "id"\n        }\n      }\n    }\n  }\n}',
      "extra": "",
      "adapter": "madeapi"
    }
    
  </script>
</head>
<body>
  <script type="text/javascript" src="ohmygraph.min.js"></script>
  <script type="text/javascript" src="adapter/ohmygraph-madeapi-adapter.min.js"></script>
  <div>
    <img src="https://raw.githubusercontent.com/coderofsalvation/ohmygraph/master/.npm/logo.png" id="logo"/>
    <span class="description">
      <b><a href="https://www.npmjs.com/package/ohmygraph" target="_blank">OHMYGRAPH!</a> look at those REST muscles!</b><br>OMG turns relational json models into one graph/REST-client. Result: no more JS / REST-gluecode for setting up relationships. Stop thinking json tree-configs & REST-calls, start thinking graph relations, combine multiple api's into one graph.
    </span>
  </div>
  <div class="right">
    <br><Br>
    <div id="adapter">
      <table>
        <tr>
          <td>
            <b>Adapter</b>&nbsp:&nbsp;
          </td>
          <td>
            <select id="adapterselect" onchange="parse()">
              <option value="none">none</option>
              <option value="madeapi">madeapi json</option>
            </select>
          </td>
          <td>
            <button onclick="var a = $('#advanced'); a.style.display = ( a.style.display == 'block' ? 'none' : 'block');">advanced</button>
          </td>
        </tr>
      </table>
      <fieldset id="advanced" style="display:none">
        <table >
          <tr>
            <td colspan="2">
              <span class="description">
                For more info on jsonschema references see the <a href="https://www.npmjs.com/package/json-ref-lite" target="_blank">json-ref-lite docs</a><br>
                For the adapters see <a href="https://github.com/search?utf8=%E2%9C%93&q=ohmygraph+adapter" target="_blank">here</a>
              </span>
            </td>
          </tr>
          <tr>
            <td>
              <b>Reference key</b>&nbsp:&nbsp;
            </td>
            <td>
              <input type="text" id="reftoken" value="$ref"/>
            </td>
          </tr>
          <tr>
            <td>
              <b>Jsonpointer token</b>&nbsp:&nbsp;
            </td>
            <td>
              <input type="text" id="pathtoken" value="#"/>
            </td>
          </tr>
          <tr>
            <td>
              <b>Extension key</b>&nbsp:&nbsp;
            </td>
            <td>
              <input type="text" id="extendtoken" value="$extend"/>
            </td>
          </tr>
        </table>
      </fieldset>
    </div>
    <div class="clear"></div>
  </div>
  <div class="clear"></div>
  <div class="left">
    <h2>
      Your OMG json:
      <select id="template" onchange="doTemplate(this);">
        <option value="none"></option>
        <option selected="selected" value="github">example: github api v3</option>
        <option value="githubextend">example: github api v3 + extend</option>
        <option value="madeapi">example: madeapi v1.0</option>
      </select>
    </h2>
    <textarea onkeyup="$('select#template').value = '';lazyParse()" spellcheck="false" id="source"></textarea>
  </div>
  <div class="right">
    <h2>▶ Exported graph nodes + functions</h2>
    <textarea spellcheck="false" id="functions"></textarea>
    <h2>▶ Resolved 'rest'-object <a style='font-size:12px' href="https://www.npmjs.com/package/json-ref-lite" target="_blank">(=json-ref-lite output)</a></h2>
    <textarea spellcheck="false" id="resolved"></textarea>
  </div>
  <div class="clear"></div>
  <script>
    $ = function(str){ return document.querySelector(str); }
    ohmygraph = require('ohmygraph');
    th = false;
    omg = false;
    example = "github"
    extra   = "";
    adapters = {
      'none': false,
      'madeapi': require("ohmygraph-madeapi-adapter")
    };

    function lazyParse(){
      if(th) return 
      parse();
      setTimeout( function(){ clearTimeout(th);}, 500 );
    }

    function doTemplate(select){
      source = "";
      if( templates[ select.value ] != undefined ){
        t = templates[ select.value ]
        if( t.json == undefined || t.extra == undefined || t.adapter == undefined ) return;
        $('#adapterselect').value = t.adapter;
        $('#source').value = t.json;
        extra = t.extra;
        parse();
      }
    }

    function parse(){
      $('#functions').innerHTML = ""
      $('#resolved').innerHTML = ""
      graph = JSON.parse( $('#source').value );
      adapter = $('#adapterselect').value; 
      opts = { verbose: 2 };
      if( adapter != 'none' ){
        a = require("ohmygraph-"+adapter+"-adapter");
        graph = a.parse(graph, '1.0', opts);
      }
      omg = ohmygraph.create(graph, opts );
      omg.init.client()
      update();
    }

    function update(){
      lines = omg.export_functions().split("\n");
      lines.pop();
      for(var i=0;i<lines.length;i++){
        lines[i] = "omg.graph."+lines[i];
      }
      $('#functions').innerHTML = lines.join("\n")+"\n\n// this was outputted by:\n//\n//\tohmygraph = require('ohmygraph');\n//\tomg = ohmygraph.create(yourjson, {baseurl:''});\n//\tomg.export_functions()\n"+extra;
      $('#resolved').innerHTML = "// output of:\n//\tohmygraph = require('ohmygraph');\n//\tomg = ohmygraph.create(yourjson, {baseurl:''});\n//\tJSON.stringify( omg.graph,null,2);\n"+JSON.stringify( omg.graph, null, 2); 
      extra = "";
    }

    doTemplate( {"value":"github"} );
    extra = templates["github"].extra;
    parse();
  </script>
</body>
</html>

