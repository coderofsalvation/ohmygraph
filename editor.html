<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="nl" lang="nl">
<head>
  <title>OMG editor</title>
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
  <meta http-equiv="Content-Language" content="nl" />
  <meta name="MSSmartTagsPreventParsing" content="true" />

  <meta name="publisher" content="Your title" />
  <meta name="copyright" content="Copyright &#169; Your title.org &amp; Mannetje Development 2010" />
  <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <style style="text/css">
    body { 
      font-family: "Open Sans", Arial; 
      font-size:16px; 
      font-color: #555;
      background: url('editor.back.jpg');
      padding:2.0em;
    }
    textarea {
      background-color:#555;
      color:#EEE;
      padding:1.0em;
      box-sizing: border-box;
    }
    div.left,
    div.right{
      width:48%;
      float:left;
    }
    div.right textarea {
      height:48vh; 
      width:48vw;
      margin-bottom:2.0em;
    }
    div.left textarea{
      width:42vw; 
      height:100vh;
    }
    .clear { clear:both; }
    div#adapter { width:300px; float:left }
    img#logo { float:left; width:44%; }
    button,select { font-size:17px; }
    span#description{ text-align:justify; color:#FFF; font-size:14px; }
    a:visited { font-weight:bold; color:#FFF }
  </style>
</head>
<body>
  <script type="text/javascript" src="ohmygraph.min.js"></script>
  <script type="text/javascript" src="node_modules/ohmygraph-madeapi-adapter/ohmygraph-madeapi-adapter.min.js"></script>
  <div>
    <img src="https://raw.githubusercontent.com/coderofsalvation/ohmygraph/master/.npm/logo.png" id="logo"/>
    <span id="description">
      <a href="https://www.npmjs.com/package/ohmygraph" target="_blank">OHMYGRAPH!</a> is a javascript library and jsonformat to write less REST-code.
      Have your servers and clients communicate using a shared jsonschema graph. Forget writing rest-interface gluecode, welcome json graph.
    </span>
  </div>
  <div class="right">
    <br><Br>
    <div id="adapter">
      <table>
        <tr>
          <td>
            <b>Adapter</b>&nbsp:&nbsp;
          </td>
          <td>
            <select>
              <option value="">none</option>
              <option value="">madeapi json</option>
            </select>
          </td>
        </tr>
      </table>
    </div>
    <div class="clear"></div>
  </div>
  <div class="clear"></div>
  <div class="left">
    <h2>Your json:</h2>
    <textarea onkeyup="lazyParse()" spellcheck="false" id="source"></textarea>
  </div>
  <div class="right">
    <h2>▶ Exported functions</h2>
    <textarea spellcheck="false" id="functions"></textarea>
    <h2>▶ Resolved 'rest'-object <a style='font-size:12px' href="https://www.npmjs.com/package/json-ref-lite" target="_blank">(=json-ref-lite output)</a></h2>
    <textarea spellcheck="false" id="resolved"></textarea>
  </div>
  <div class="clear"></div>
  <script>
    $ = function(str){ return document.querySelector(str); }
    ohmygraph = require('ohmygraph');
    th = false;
    omg = false;
    extra = "//\n// just try the above calls in your browser console, like:\n//\n//   repositories = omg.graph.repositories;\n//   repositories.get() // <- returns array of 'repository' objects..sweet!\n//\n// also you can pass payloads like this:\n//\n//    repositories.get({sort:'asc'})\n// or using variable binding like this:\n//\n//    &lt;form onsubmit=\"repositories.get()\"&gt;\n//      &lt;input onchange=\"repositories.data.q = this.value\"/&gt;\n//    &lt;/form&gt;\n\n";

    function lazyParse(){
      if(th) return 
      parse();
      setTimeout( function(){ clearTimeout(th);}, 500 );
    }

    function parse(){
      $('#functions').innerHTML = ""
      $('#resolved').innerHTML = ""
      graph = JSON.parse( $('#source').value );
      omg = ohmygraph.create(graph, {
        baseurl: "https://api.github.com",
        verbose: 2
      });
      omg.init.client()
      update();
    }

    function update(){
      lines = omg.export_functions().split("\n");
      lines.pop();
      for(var i=0;i<lines.length;i++){
        lines[i] = "omg.graph."+lines[i];
      }
      $('#functions').innerHTML = lines.join("\n")+"\n\n// this was outputted by:\n//\n//\tohmygraph = require('ohmygraph');\n//\tomg = ohmygraph.create(yourjson, {baseurl:''});\n//\tomg.export_functions()\n"+extra;
      $('#resolved').innerHTML = "// output of:\n//\tohmygraph = require('ohmygraph');\n//\tomg = ohmygraph.create(yourjson, {baseurl:''});\n//\tJSON.stringify( omg.graph,null,2);\n"+JSON.stringify( omg.graph, null, 2); 
      extra = "";
    }

    source = $('#source');
    json = '{\n  "repositories": {\n    "output": [\n      {\n        "$ref": "#ui.console"\n      }\n    ],\n    "type": "array",\n    "items": [\n      {\n        "$ref": "#repository"\n      }\n    ],\n    "input": {\n      "order": {\n        "type": "string",\n        "enum": [\n          "asc",\n          "desc"\n        ],\n        "value": "asc"\n      },\n      "sort": {\n        "type": "string",\n        "enum": [\n          "created",\n          "stars",\n          "updated",\n          "pushed"\n        ],\n        "value": "stars"\n      },\n      "q": {\n        "type": "string",\n        "value": "ohmygod"\n      }\n    },\n    "request": {\n      "get": {\n        "config": {\n          "method": "get",\n          "url": "https://api.github.com/search/repositories",\n          "payload": {\n            "q": "{repositories.input.q.value}",\n            "sort": "{repositories.input.sort.value}",\n            "order": "{repositories.input.order.value}"\n          }\n        },\n        "data": "{response.items}"\n      }\n    }\n  },\n  "repository": {\n    "type": "object",\n    "data": {},\n    "properties": {\n      "html_url": {\n        "type": "string"\n      },\n      "stargazers_count": {\n        "type": "number"\n      },\n      "owner": {\n        "type": "object",\n        "properties": {\n          "login": {\n            "type": "string"\n          }\n        }\n      }\n    },\n    "request": {\n      "get": {\n        "config": {\n          "method": "get",\n          "url": "https://api.github.com/repos/{repository.data.full_name}",\n          "payload": {}\n        },\n        "data": "{response}"\n      },\n      "post": {\n        "type": "request",\n        "config": {\n          "method": "post",\n          "url": "/repos/{repository.data.full_name}",\n          "payload": {\n            "full_name": "{repository.data.full_name}"\n          }\n        }\n      }\n    }\n  }\n}';
    source.innerHTML = json
    parse();

  </script>
</body>
</html>

